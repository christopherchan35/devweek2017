<h1>Shelters</h1>

<table>
  <thead>
    <tr>
      <th>Sheltername</th>
      <th>Location</th>
      <th>Total Beds</th>
      <th>Open Beds</th>
    </tr>
  </thead>

  <tbody>
    <% @shelters.each do |shelter| %>
      <tr class='shelterrow'>
        <td><%= shelter.name %></td>
        <td><%= shelter.location %></td>
        <td><%= shelter.total_beds %></td>
        <td id=<%= "#{shelter.id}" %>><%= shelter.open_beds %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
    <div id="map"></div>
    <script>
      function initMap() {
        var uluru = {lat: 37.47, lng: -122.25};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: uluru
        });
        var marker = new google.maps.Marker({
          position: uluru,
          map: map
        });

        var marker2 = new google.maps.Marker({
          
        });
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_MAPS']%>&callback=initMap">
    </script>

<script>
var pubnub = new PubNub({
    subscribeKey: <%= ENV['PUBNUB_SUB'] %>
});


pubnub.addListener({
    message: function(message) {
      var td = $('#' + message.message.name)
        td.html(message.message.value)
        td.css('background', 'red')

        setTimeout(function(){
          td.css('transition', 'background 5s')
          td.css('background', 'white')
          setTimeout(function(){
            td.css('transition', 'none')
          }, 5000)
        }, 0)

    }
})

pubnub.subscribe({
    channels: ['tic-tac-toe']
});

</script>
